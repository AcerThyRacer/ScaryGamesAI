/** * Visual Regression Tests * Phase 1: Testing Infrastructure Expansion * * These tests capture screenshots and compare them against baseline images * to detect visual regressions. */ const { test, expect } = require('@playwright/test'); test.describe('Visual Regression Tests', () => { test('homepage hero section', async ({ page }) => { await page.goto('/'); // Wait for content to load await page.waitForSelector('.hero, .hero-section', { timeout: 10000 }); // Wait for animations to settle await page.waitForTimeout(1000); // Take screenshot const hero = page.locator('.hero, .hero-section').first(); await expect(hero).toHaveScreenshot('homepage-hero.png', { maxDiffPixels: 1000, threshold: 0.2, }); }); test('game card appearance', async ({ page }) => { await page.goto('/'); // Wait for games to load await page.waitForSelector('.game-card', { timeout: 10000 }); // Take screenshot of first game card const gameCard = page.locator('.game-card').first(); await expect(gameCard).toHaveScreenshot('game-card.png', { maxDiffPixels: 500, threshold: 0.2, }); }); test('navigation bar', async ({ page }) => { await page.goto('/'); // Wait for nav to load await page.waitForSelector('nav, .nav, .navbar', { timeout: 10000 }); // Take screenshot const nav = page.locator('nav, .nav, .navbar').first(); await expect(nav).toHaveScreenshot('navigation.png', { maxDiffPixels: 500, threshold: 0.2, }); }); test('games page layout', async ({ page }) => { await page.goto('/games.html'); // Wait for content await page.waitForSelector('.game-card, .games-grid', { timeout: 10000 }); await page.waitForTimeout(500); // Full page screenshot await expect(page).toHaveScreenshot('games-page.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('store page layout', async ({ page }) => { await page.goto('/store.html'); // Wait for content await page.waitForSelector('.store-item, .store-grid', { timeout: 10000 }); await page.waitForTimeout(500); // Full page screenshot await expect(page).toHaveScreenshot('store-page.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('subscription page layout', async ({ page }) => { await page.goto('/subscription.html'); // Wait for content await page.waitForSelector('.subscription-card, .tier-card', { timeout: 10000 }); await page.waitForTimeout(500); // Full page screenshot await expect(page).toHaveScreenshot('subscription-page.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('achievements page layout', async ({ page }) => { await page.goto('/achievements.html'); // Wait for content await page.waitForSelector('.achievement-card, .achievements-grid', { timeout: 10000 }); await page.waitForTimeout(500); // Full page screenshot await expect(page).toHaveScreenshot('achievements-page.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('leaderboards page layout', async ({ page }) => { await page.goto('/leaderboards.html'); // Wait for content await page.waitForSelector('.leaderboard-entry, .leaderboard', { timeout: 10000 }); await page.waitForTimeout(500); // Full page screenshot await expect(page).toHaveScreenshot('leaderboards-page.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('mobile homepage layout', async ({ page, isMobile }) => { if (!isMobile) { test.skip(); return; } await page.goto('/'); await page.waitForSelector('.game-card', { timeout: 10000 }); await page.waitForTimeout(500); // Mobile screenshot await expect(page).toHaveScreenshot('mobile-homepage.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); test('tablet homepage layout', async ({ page, viewportWidth }) => { // Check if tablet viewport if (viewportWidth < 768 || viewportWidth > 1024) { test.skip(); return; } await page.goto('/'); await page.waitForSelector('.game-card', { timeout: 10000 }); await page.waitForTimeout(500); // Tablet screenshot await expect(page).toHaveScreenshot('tablet-homepage.png', { fullPage: true, maxDiffPixels: 2000, threshold: 0.2, }); }); }); test.describe('Component Visual Tests', () => { test('filter bar appearance', async ({ page }) => { await page.goto('/'); await page.waitForSelector('.filter-bar', { timeout: 10000 }); const filterBar = page.locator('.filter-bar'); await expect(filterBar).toHaveScreenshot('filter-bar.png', { maxDiffPixels: 300, threshold: 0.2, }); }); test('footer appearance', async ({ page }) => { await page.goto('/'); await page.waitForSelector('footer, .footer', { timeout: 10000 }); const footer = page.locator('footer, .footer').first(); await expect(footer).toHaveScreenshot('footer.png', { maxDiffPixels: 500, threshold: 0.2, }); }); test('modal appearance', async ({ page }) => { await page.goto('/'); await page.waitForSelector('.game-card', { timeout: 10000 }); // Trigger modal const lockedCard = page.locator('.game-card.game-card-locked').first(); if (await lockedCard.isVisible()) { await lockedCard.locator('.game-upgrade-btn').click(); await page.waitForSelector('#upgrade-modal, .upgrade-modal', { timeout: 5000 }); const modal = page.locator('#upgrade-modal, .upgrade-modal'); await expect(modal).toHaveScreenshot('upgrade-modal.png', { maxDiffPixels: 500, threshold: 0.2, }); } }); });