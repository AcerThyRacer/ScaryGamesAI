<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caribbean Conquest - 3D Pirate Adventure</title>
    <link rel="stylesheet" href="/css/base.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #000; font-family: 'Inter', sans-serif; }
        #game-container { width: 100vw; height: 100vh; position: relative; }
        
        /* Loading Screen */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0a1628 0%, #1a3a5c 50%, #0d2137 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; transition: opacity 0.5s;
        }
        #loading-screen.hidden { opacity: 0; pointer-events: none; }
        .loading-title { font-size: 48px; color: #ffd700; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); margin-bottom: 20px; font-family: 'Pirata One', cursive; }
        .loading-subtitle { font-size: 18px; color: #88ccff; margin-bottom: 40px; }
        .loading-bar-container { width: 300px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .loading-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #ffd700, #ff8c00); border-radius: 4px; transition: width 0.3s; }
        .loading-text { margin-top: 15px; color: #aaa; font-size: 14px; }
        
        /* HUD */
        #hud { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        #hud > * { pointer-events: auto; }
        
        .hud-top { position: absolute; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; align-items: flex-start; }
        
        .player-info { background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 15px; min-width: 200px; }
        .player-name { color: #ffd700; font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .stat-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 5px 0; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
        .health-fill { background: linear-gradient(90deg, #ff4444, #cc0000); }
        .mana-fill { background: linear-gradient(90deg, #4488ff, #0044cc); }
        .stat-label { color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
        
        .minimap-container { width: 180px; height: 180px; background: rgba(0, 0, 0, 0.7); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 50%; overflow: hidden; position: relative; }
        .minimap { width: 100%; height: 100%; position: relative; }
        .minimap-player { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; background: #ffd700; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px #ffd700; }
        .compass { position: absolute; top: 50%; left: 50%; width: 160px; height: 160px; transform: translate(-50%, -50%); border: 2px solid rgba(255, 215, 0, 0.2); border-radius: 50%; }
        .compass::before { content: 'N'; position: absolute; top: 5px; left: 50%; transform: translateX(-50%); color: #ffd700; font-size: 12px; font-weight: bold; }
        
        /* Ship Controls */
        .ship-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 20px; align-items: flex-end; }
        .control-panel { background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 15px; }
        .speed-indicator { text-align: center; }
        .speed-value { font-size: 32px; color: #ffd700; font-weight: bold; }
        .speed-unit { color: #888; font-size: 12px; }
        .wind-indicator { display: flex; align-items: center; gap: 10px; }
        .wind-arrow { width: 40px; height: 40px; border: 2px solid #88ccff; border-radius: 50%; position: relative; }
        .wind-info { color: #88ccff; }
        .wind-speed { font-size: 18px; font-weight: bold; }
        .wind-direction { font-size: 11px; color: #668899; }
        
        /* Ship Status */
        .ship-status { position: absolute; bottom: 100px; left: 20px; background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 15px; min-width: 250px; }
        .ship-name { color: #ffd700; font-size: 16px; font-weight: bold; margin-bottom: 10px; }
        .ship-stat { display: flex; align-items: center; margin: 8px 0; }
        .ship-stat-icon { width: 24px; text-align: center; margin-right: 10px; }
        .ship-stat-bar { flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .ship-stat-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
        .hull-fill { background: linear-gradient(90deg, #88ff88, #44aa44); }
        .sail-fill { background: linear-gradient(90deg, #ffff88, #cccc44); }
        .crew-fill { background: linear-gradient(90deg, #ff88ff, #aa44aa); }
        .cargo-fill { background: linear-gradient(90deg, #88ffff, #44aaaa); }
        
        /* Ammunition Selector */
        .ammo-selector { position: absolute; bottom: 80px; right: 20px; display: flex; flex-direction: column; gap: 5px; }
        .ammo-title { color: #ffd700; font-size: 12px; text-align: center; margin-bottom: 5px; }
        .ammo-slots { display: flex; gap: 5px; }
        .ammo-slot { width: 45px; height: 45px; background: rgba(0, 0, 0, 0.7); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 18px; cursor: pointer; transition: all 0.2s; position: relative; }
        .ammo-slot:hover { border-color: #ffd700; background: rgba(255, 215, 0, 0.1); }
        .ammo-slot.selected { border-color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); background: rgba(255, 215, 0, 0.2); }
        .ammo-count { font-size: 10px; color: #aaa; position: absolute; bottom: 2px; right: 4px; }
        
        /* Action Bar */
        .action-bar { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 8px; }
        .action-slot { width: 50px; height: 50px; background: rgba(0, 0, 0, 0.7); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; transition: all 0.2s; position: relative; }
        .action-slot:hover { border-color: #ffd700; background: rgba(255, 215, 0, 0.1); }
        .action-slot.active { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
        .action-key { position: absolute; bottom: 2px; right: 4px; font-size: 10px; color: #888; }
        
        /* Quest Tracker */
        .quest-tracker { position: absolute; top: 100px; right: 20px; background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px; padding: 15px; max-width: 280px; }
        .quest-title { color: #ffd700; font-size: 14px; font-weight: bold; margin-bottom: 8px; }
        .quest-objective { color: #ccc; font-size: 12px; margin: 5px 0; display: flex; align-items: center; gap: 8px; }
        .quest-check { width: 14px; height: 14px; border: 1px solid #666; border-radius: 3px; }
        .quest-check.complete { background: #44aa44; border-color: #44aa44; }
        
        /* Notifications */
        .notification-area { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
        .notification { background: rgba(0, 0, 0, 0.8); border: 1px solid rgba(255, 215, 0, 0.5); border-radius: 8px; padding: 15px 30px; margin: 10px 0; animation: fadeInOut 3s forwards; }
        .notification-title { color: #ffd700; font-size: 18px; font-weight: bold; }
        .notification-text { color: #ccc; font-size: 14px; margin-top: 5px; }
        @keyframes fadeInOut { 0% { opacity: 0; transform: translateY(20px); } 10% { opacity: 1; transform: translateY(0); } 80% { opacity: 1; } 100% { opacity: 0; } }
        
        /* Crosshair */
        .crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; pointer-events: none; }
        .crosshair::before, .crosshair::after { content: ''; position: absolute; background: rgba(255, 255, 255, 0.5); }
        .crosshair::before { width: 2px; height: 100%; left: 50%; transform: translateX(-50%); }
        .crosshair::after { width: 100%; height: 2px; top: 50%; transform: translateY(-50%); }
        
        /* Pause Menu */
        #pause-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; align-items: center; justify-content: center; z-index: 200; }
        #pause-menu.active { display: flex; }
        .pause-content { text-align: center; }
        .pause-title { font-size: 48px; color: #ffd700; margin-bottom: 40px; font-family: 'Pirata One', cursive; }
        .pause-button { display: block; width: 200px; margin: 15px auto; padding: 15px 30px; background: rgba(255, 215, 0, 0.1); border: 2px solid #ffd700; border-radius: 8px; color: #ffd700; font-size: 18px; cursor: pointer; transition: all 0.2s; }
        .pause-button:hover { background: rgba(255, 215, 0, 0.2); transform: scale(1.05); }
        
        @media (max-width: 768px) {
            .hud-top { flex-direction: column; gap: 10px; }
            .minimap-container { width: 120px; height: 120px; }
            .ship-status, .quest-tracker { display: none; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pirata+One&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-title">‚öîÔ∏è Caribbean Conquest ‚öîÔ∏è</div>
        <div class="loading-subtitle">Set sail for glory and plunder</div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loading-bar"></div>
        </div>
        <div class="loading-text" id="loading-text">Initializing...</div>
    </div>

    <!-- Game Container -->
    <div id="game-container"></div>

    <!-- HUD -->
    <div id="hud" style="display: none;">
        <!-- Top Bar -->
        <div class="hud-top">
            <div class="player-info">
                <div class="player-name">Captain Blackwood</div>
                <div class="stat-label">Hull Integrity</div>
                <div class="stat-bar"><div class="stat-bar-fill health-fill" style="width: 100%"></div></div>
                <div class="stat-label">Crew Morale</div>
                <div class="stat-bar"><div class="stat-bar-fill mana-fill" style="width: 85%"></div></div>
            </div>
            <div class="minimap-container">
                <div class="compass"></div>
                <div class="minimap"><div class="minimap-player"></div></div>
            </div>
        </div>

        <!-- Ship Status -->
        <div class="ship-status">
            <div class="ship-name">‚öì The Black Serpent</div>
            <div class="ship-stat">
                <div class="ship-stat-icon">üõ°Ô∏è</div>
                <div class="ship-stat-bar"><div class="ship-stat-fill hull-fill" id="hull-bar" style="width: 100%"></div></div>
            </div>
            <div class="ship-stat">
                <div class="ship-stat-icon">‚õµ</div>
                <div class="ship-stat-bar"><div class="ship-stat-fill sail-fill" id="sail-bar" style="width: 100%"></div></div>
            </div>
            <div class="ship-stat">
                <div class="ship-stat-icon">üë•</div>
                <div class="ship-stat-bar"><div class="ship-stat-fill crew-fill" id="crew-bar" style="width: 80%"></div></div>
            </div>
            <div class="ship-stat">
                <div class="ship-stat-icon">üì¶</div>
                <div class="ship-stat-bar"><div class="ship-stat-fill cargo-fill" id="cargo-bar" style="width: 45%"></div></div>
            </div>
        </div>

        <!-- Ship Controls -->
        <div class="ship-controls">
            <div class="control-panel wind-indicator">
                <div class="wind-arrow" id="wind-arrow"></div>
                <div class="wind-info">
                    <div class="wind-speed" id="wind-speed">12 kts</div>
                    <div class="wind-direction" id="wind-dir">NE Trade Winds</div>
                </div>
            </div>
            <div class="control-panel speed-indicator">
                <div class="speed-value" id="ship-speed">8.5</div>
                <div class="speed-unit">knots</div>
            </div>
        </div>

        <!-- Ammunition Selector -->
        <div class="ammo-selector">
            <div class="ammo-title">AMMUNITION</div>
            <div class="ammo-slots">
                <div class="ammo-slot selected" data-ammo="round" title="Round Shot - Standard hull damage">üîµ <span class="ammo-count" id="ammo-round">100</span></div>
                <div class="ammo-slot" data-ammo="chain" title="Chain Shot - Destroys sails">‚õìÔ∏è <span class="ammo-count" id="ammo-chain">50</span></div>
                <div class="ammo-slot" data-ammo="grape" title="Grapeshot - Anti-crew">üçá <span class="ammo-count" id="ammo-grape">30</span></div>
                <div class="ammo-slot" data-ammo="explosive" title="Explosive Shell - Area damage">üí£ <span class="ammo-count" id="ammo-explosive">10</span></div>
            </div>
            <div style="display: flex; gap: 5px; justify-content: center;"><span style="color: #888; font-size: 10px;">[1] [2] [3] [4]</span></div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <div class="action-slot" data-action="fire-left" title="Fire Port Cannons">üí• <span class="action-key">Q</span></div>
            <div class="action-slot" data-action="fire-right" title="Fire Starboard Cannons">üí• <span class="action-key">E</span></div>
            <div class="action-slot" data-action="board" title="Board Enemy Ship">‚öîÔ∏è <span class="action-key">B</span></div>
            <div class="action-slot" data-action="anchor" title="Drop/Weigh Anchor">‚öì <span class="action-key">X</span></div>
            <div class="action-slot" data-action="repair" title="Repair Ship">üîß <span class="action-key">R</span></div>
            <div class="action-slot" data-action="map" title="World Map">üó∫Ô∏è <span class="action-key">M</span></div>
        </div>

        <!-- Quest Tracker -->
        <div class="quest-tracker">
            <div class="quest-title">üìú Current Voyage</div>
            <div class="quest-objective"><div class="quest-check"></div><span>Sail to Kingston Port</span></div>
            <div class="quest-objective"><div class="quest-check"></div><span>Deliver cargo (0/3)</span></div>
            <div class="quest-objective"><div class="quest-check"></div><span>Return for reward</span></div>
        </div>

        <!-- Crosshair -->
        <div class="crosshair"></div>

        <!-- Notification Area -->
        <div class="notification-area" id="notifications"></div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu">
        <div class="pause-content">
            <div class="pause-title">‚öì Anchored ‚öì</div>
            <button class="pause-button" onclick="resumeGame()">Continue</button>
            <button class="pause-button" onclick="openSettings()">Settings</button>
            <button class="pause-button" onclick="saveGame()">Save Game</button>
            <button class="pause-button" onclick="exitToMenu()">Exit to Menu</button>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Game Scripts -->
    <script src="engine/renderer.js"></script>
    <script src="engine/ocean.js"></script>
    <script src="engine/sky.js"></script>
    <script src="engine/physics.js"></script>
    <script src="engine/camera.js"></script>
    <script src="entities/ship.js"></script>
    <script src="entities/player.js"></script>
    <script src="systems/input.js"></script>
    <script src="systems/weather.js"></script>
    <script src="systems/combat.js"></script>
    <script src="systems/combat-enhanced.js"></script>
    <script src="systems/ai.js"></script>
    <script src="systems/ai-enhanced.js"></script>
    <script src="systems/quest.js"></script>
    <script src="ui/hud.js"></script>
    <script src="game.js"></script>
</body>
</html>