// Caribbean Conquest - Quest System // Handles missions, objectives, and rewards class QuestSystem { constructor(game) { this.game = game; // Active quests this.activeQuests = []; this.completedQuests = []; // Quest templates this.questTemplates = { delivery: { name: 'Merchant Delivery', description: 'Deliver cargo to the destination port', objectives: [ { type: 'reach', target: 'port', description: 'Sail to {destination}' }, { type: 'deliver', item: 'cargo', description: 'Deliver cargo ({current}/{total})' }, { type: 'return', description: 'Return for payment' } ], rewards: { gold: 500, renown: 50 } }, hunt: { name: 'Pirate Hunter', description: 'Hunt down the pirate ship', objectives: [ { type: 'destroy', target: 'ship', description: 'Destroy the pirate ship' } ], rewards: { gold: 1000, renown: 100 } }, escort: { name: 'Escort Mission', description: 'Protect the merchant vessel', objectives: [ { type: 'escort', description: 'Escort merchant to {destination}' }, { type: 'protect', description: 'Keep the merchant ship safe' } ], rewards: { gold: 750, renown: 75 } }, treasure: { name: 'Treasure Hunt', description: 'Find the buried treasure', objectives: [ { type: 'discover', target: 'island', description: 'Find the uncharted island' }, { type: 'dig', description: 'Dig for treasure at the marked spot' } ], rewards: { gold: 2000, renown: 150, item: 'rare_artifact' } } }; // Current objective tracking this.currentObjective = null; } init() { // Start with a delivery quest this.startQuest('delivery', { destination: 'Kingston', cargo: 'Spices', total: 3 }); } startQuest(type, params = {}) { const template = this.questTemplates[type]; if (!template) return false; const quest = { id: Date.now(), type: type, name: template.name, description: template.description, objectives: template.objectives.map(obj => ({ ...obj, completed: false, current: 0, total: obj.total || 1, params: params })), rewards: { ...template.rewards }, startTime: this.game.gameTime }; this.activeQuests.push(quest); this.currentObjective = quest.objectives[0]; this.updateQuestUI(); this.game.hud?.showNotification('New Voyage: ' + quest.name, quest.description); return true; } update(dt) { // Check objective completion for (const quest of this.activeQuests) { this.checkObjectives(quest, dt); } } checkObjectives(quest, dt) { for (let i = 0; i < quest.objectives.length; i++) { const obj = quest.objectives[i]; if (obj.completed) continue; switch (obj.type) { case 'reach': this.checkReachObjective(obj); break; case 'destroy': this.checkDestroyObjective(obj); break; case 'deliver': this.checkDeliverObjective(obj); break; } } // Check if all objectives complete const allComplete = quest.objectives.every(obj => obj.completed); if (allComplete) { this.completeQuest(quest); } } checkReachObjective(obj) { // Check if player reached destination // For now, simplified check const player = this.game.player; if (!player) return; // TODO: Check actual port/island proximity // For demo, complete after sailing for 30 seconds if (this.game.gameTime > 30) { obj.completed = true; this.advanceObjective(obj); } } checkDestroyObjective(obj) { // Check if target ship destroyed // Handled by combat system } checkDeliverObjective(obj) { // Check cargo delivery // Simplified for demo } advanceObjective(completedObj) { for (const quest of this.activeQuests) { const index = quest.objectives.indexOf(completedObj); if (index !== -1 && index < quest.objectives.length - 1) { this.currentObjective = quest.objectives[index + 1]; this.updateQuestUI(); this.game.hud?.showNotification('Objective Complete!', this.currentObjective.description); break; } } } completeQuest(quest) { const index = this.activeQuests.indexOf(quest); if (index > -1) { this.activeQuests.splice(index, 1); this.completedQuests.push(quest); // Grant rewards this.game.hud?.showNotification( 'Voyage Complete!', '+' + quest.rewards.gold + ' Gold, +' + quest.rewards.renown + ' Renown' ); // Start next quest after delay setTimeout(() => { const types = Object.keys(this.questTemplates); const randomType = types[Math.floor(Math.random() * types.length)]; this.startQuest(randomType, { destination: 'Nassau' }); }, 5000); } } updateQuestUI() { const tracker = document.querySelector('.quest-tracker'); if (!tracker) return; const quest = this.activeQuests[0]; if (!quest) { tracker.style.display = 'none'; return; } tracker.style.display = 'block'; const titleEl = tracker.querySelector('.quest-title'); if (titleEl) titleEl.textContent = 'ðŸ“œ ' + quest.name; const objectivesHtml = quest.objectives.map(obj => ` <div class="quest-objective"> <div class="quest-check ${obj.completed ? 'complete' : ''}">${obj.completed ? 'âœ“' : ''}</div> <span>${obj.description.replace('{destination}', obj.params.destination || 'destination')}</span> </div> `).join(''); // Update objectives tracker.innerHTML = ` <div class="quest-title">ðŸ“œ ${quest.name}</div> ${objectivesHtml} `; } }